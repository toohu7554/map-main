<!DOCTYPE html>
<html>
	<head> /*aaa*/
		<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
		<title>Insert title here</title>
		<!--新発田ずかん-->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
        <!--<link rel="stylesheet" href="https://shibatazukan.github.io/pages/assets/css/home.css">-->
        <link rel="stylesheet" href="https://shibatazukan.github.io/pages/assets/css/hamburger_menu.css">
		<!--leaflet-->
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.0/dist/leaflet.css" />
		<script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js"></script>
		<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
		<script src ="https://data.earth.jaxa.jp/api/javascript/v1.2.2/jaxa.earth.umd.js"></script>	
		<script src="https://unpkg.com/georaster"></script>
		<script src="https://unpkg.com/georaster-layer-for-leaflet"></script>
		<script src="example1.js" type="module"></script>
		<!-- plugin -->
			<link rel="stylesheet" href="https://github.com/toohu7554/geolocation/blob/main/folder/css3/leaflet-search.min.css">
			<script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
			<script src="js/L.Control.Locate.min.js"></script> /*位置表示用*/
		<script src="https://github.com/toohu7554/geolocation/blob/main/folder/js/L.Control.Locate.min.js.map"></script>  /*位置表示用*(目的不明)/
		<!-- leaflet プラグインCSS-->
			<link rel="stylesheet" href="https://unpkg.com/leaflet-switch-basemap@1.0.6/src/L.switchBasemap.css" crossorigin=""/>
			<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
			<link rel="stylesheet" href="https://github.com/toohu7554/geolocation/blob/main/folder/css3/L.Control.Locate.min.css" /> /*位置表示用*/
			<link rel="stylesheet" href="https://github.com/toohu7554/geolocation/blob/main/folder/css3/L.Control.Locate.min.css.map"/>/*位置表示用（目的不明）*/
		 <!-- Plugin Icon.Pulse -->
	    	<link rel="stylesheet" href="https://github.com/toohu7554/geolocation/blob/main/folder/css3/L.Icon.Pulse.min.css" >
	    	<script src="https://github.com/toohu7554/geolocation/blob/main/folder/js/L.Icon.Pulse.min.js" ></script>
			
    
    
		<!--coastline -->
			<link rel="coastline" href="https://github.com/toohu7554/geolocation/blob/main/folder/coastline.js">
		<style>	     
			*{
				margin:0;
				padding:0;
			}						
			/* マップを含む div 要素のサイズを設定します。 */
			#map-container {
				height: 400px;
				width: 100%;
				background-color: #eee;
			}
			#map {width:100%; height:600px; border: solid 5px green;}
			#rain_fall {
				height: 600px;
				width: 600px;
				display: flex;
				justify-content: center;
			}
			#map_canvas1 {background-color:orange};
			input {
				margin: 10px;
				padding: 5px;
			}
			#mapcontainer {border: solid 5px oreage;};
		</style>						   							  					        
	<!--  <script> src="https://API"</script>-->
	<!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIizo70tgJ67AwMGUBAj3kEivOVfqiwcc"></script> -->		
	</head>
	<body>
		<h1>JavaScript練習中1</h1>
		<h2>DownLoad</h2><br>
		<h2>想定している機能</h2>
		<p>・HP訪問者の位置情報の取得</p>
		<p>・初期位置から表示する範囲(ズームレベル,中心地点から半径何kmなど)表示</p>
		<p>・表示範囲の切り替え｛UI｝方法(スワイプ/マウス操作,[+][-])タブなどを使う)</p>
		<nav class="side-menu" id="sideMenu">
            <div class="menu-title"><i class="fa-solid fa-user"></i> <span id="userNameDisplay">ユーザー名</span></div>
            <a href="https://shibatazukan.github.io/pages/home/index.html"><i class="fa-solid fa-house"></i> ホーム</a>
            <a href="https://shibatazukan.github.io/pages/zukan/list.html"><i class="fa-solid fa-scroll"></i> ずかん</a>
            <a href="https://shibatazukan.github.io/pages/camera/index.html"><i class="fa-solid fa-camera"></i> カメラ</a>
            <a href="https://shibatazukan.github.io/pages/map/folder/index.html"><i class="fa-solid fa-map"></i> マップ</a>

            <div class="menu-divider"></div>
            <button class="menu-item" id="shareData">
                <i class="fa-solid fa-share"></i> データを共有/ファイルに保存
            </button>
            <button class="menu-item" id="loadData">
                <i class="fa-solid fa-upload"></i> データをロード
            </button>
            <input type="file" id="fileInput" class="file-input" accept=".json">
            <div class="menu-divider"></div>
            <a href="settings.html"><i class="fa-solid fa-gear"></i> せってい</a>
            <a href="../help/index.html"><i class="fa-solid fa-circle-question"></i> ヘルプ</a>
        </nav>
		<p>kokoko</p>
		<button type="button" onclick="ShowAlert()">ここをクリック</button>
		<button type="image" onclick="onSignInButtonClick()">ここをクリック</button>						 
	
		<div> <!--div始まり ----------------------------------------------------------->
			 <div id="mapcontainer" style="width:600px;height:600px"></div>
			 <div id="map" style="width:600px;height:600px"></div>	
			 <div class="txt-margin">
				 <p>緯度：<span id="latitude">???</span><span>度</span></p>
				 <p>経度：<span id="longitude">???</span><span>度</span></p>
				 <p>高度：<span id="altitude">???</span><span>度</span></p>		            
			 </div>
				<p>activemap直下</p>
			<!--<div id "map"></div>-->
		</div>

		<div class="menu-toggle" id="menuToggle">
            <i class="fa-solid fa-bars"></i>
        </div>
        <div id="background-clear"></div>
        <div id="background-blur"></div>
        <div class="overlay" id="overlay">
				<div class="title-block">
                <h1>新発田ずかん</h1>
                <div class="subtitle">しばたの自然を楽しむWebアプリ</div>
            </div>
		<template>
			<div id="rain_fall" ref="rainFall">
				<canvas ref="map" />
			</div>						
			<div>
				<input type="date" v-model="dateInput" />
			</div>
		</template>				            				   						   						   						   						  
		<!-- Googleでログイン」ボタン、最初は隠れている。-->                                    					      											 	
		</div> <!--div終わり -------------------------------------------------------------->
		
		<!-- JAXA Earth API for JavaScript を読み込み（API ドキュメントに従って取得） -->				 	
		<main>										<!-- canvasその1 -->
			<div id="mapid"></div>
			<div id="map_canvas1" style="width:300px; height:300px"></div>	
			<canvas id="canvas" width="200" height="200"> </canvas> 
			<canvas width="100" height="100" style="border: solid 5pt orange"> SOMETHING GOES WRONG </canvas>

			<canvas id="stockGraph" width="150" height="150">
  				現在の株価: $3.15 + 0.15
			</canvas>
			<div id="map-container"></div> <!-- 地図が追加される要素. -->		            		         		          
			<p id="temperature"></p>
			<p>アカウントにログインしてください:<span id="map-container">???</span><span>確認用</span></p>
		</main>        														 				
		<script>
							//ポップアップ-----------------------------------------------------------------------------------------------------------------------
					{
							function ShowAlert() {
								alert("30秒後にシャットダウンします");
							}	
					}
							//現在の温度を表示---------------------------------------------------------------------------------------------------------
					{
								const apiUrl = 'https://api.open-meteo.com/v1/forecast?latitude=37.56&longitude=139.19&hourly=temperature_2m&timezone=Asia/Tokyo';							
								// 非同期でAPIリクエストを送信し、データを取得でき次第画面に表示
								fetch(apiUrl)
								.then(response => {
										if (!response.ok) {
											// HTTPステータスが200番台以外の場合にエラーをスロー
											throw new Error(`HTTP error! status: ${response.status}`);
										}
									return response.json(); // JSON形式に変換
								})					              					              					              					              					             								 
								//【ここにAPIレスポンスからのデータ取得処理を実装】								   
								.then(data => { // データ取得成功時の処理
								// APIレスポンスの構造を確認し、データが存在するかチェック
									if (data && data.hourly && data.hourly.temperature_2m && data.hourly.temperature_2m.length > 0) {
											const latestTemperature = data.hourly.temperature_2m[0];										  
											// HTMLのp要素に気温を出力
											const temperatureElement = document.getElementById('temperature');
											temperatureElement.textContent = `現在の気温は${latestTemperature}℃です`; // バッククォートを使用										  
										} else {
													console.warn('APIレスポンスに予期せぬデータ形式、または気温データが見つかりませんでした。');
													const temperatureElement = document.getElementById('temperature');
													temperatureElement.textContent = '気温データを取得できませんでした。';
									}
								})								
								.catch(error => { // エラー発生時の処理
									console.error('データ取得に失敗しました:', error); // エラー内容をコンソールに出力
									const temperatureElement = document.getElementById('temperature');
									temperatureElement.textContent = '気温データの取得中にエラーが発生しました。詳細はコンソールを確認してください。';
								});
					}
																			
							//現在地を取得（GPSによる位置情報を取得出来た場合は上書き交信）-----------------------------------------------------------------------------------------------------
					{
															//https://qiita.com/orangecarol/items/c84efeca519e2d97bb34	
															/*                           										  
														 「*メゾット」
														  //getCurrentPosition() -->デバイスの現在位置を取得する
														  //watchPosition()      -->デバイスの位置情報を監視する
														 // clearWatch()         -->watchPosition()メソッドで取得中のデバイスの監視状況をクリアする						  
														 //「コールバック関数」
														 // PositionCallback　　 -->位置情報の取得が成功したときに呼び出される(引数:Positionオブジェクト)
														 // PositionErrorCallback-->位置情報の取得が失敗したときに呼び出される(引数:PositionErrorオブジェクト) */						  									
								navigator.geolocation.getCurrentPosition(successCallback, errorCallback); //現在位置を取得			
								function successCallback(position){   //成功した場合									
									var latitude = position.coords.latitude;  //現在位置情報(緯度)を持つCoordinatesオブジェクトを取得する
									var longitude = position.coords.longitude;//現在位置情報(経度)を持つCoordinatesオブジェクトを取得する				
									var altitude = position.coords.altitude; //現在位置情報(高度)を持つCoordinatesオブジェクトを取得する
									alert("位置情報の取得に成功しました。");
									document.getElementById("latitude").innerHTML = latitude;
									document.getElementById("longitude").innerHTML = longitude;
									document.getElementById("altitude").innerHTML = altitude;
									
									console.log('経度:${latitude}');
									console.log('緯度:${longitude}');
								};																					
								//取得出来なかった場合--------------------------------------------------------------------------
								function errorCallback(error){
									alert("[GPS]位置情報が取得できませんでした");
								};														
				    }
							//---------------------------------------------------------------------------------------------------	
								
				
							
					{
									//全てのクラスやメソッドはグローバルオブジェクトに定義されたjeを使ってアクセスします。
							console.log(je);
							console.log("OK");
							//UMD形式ではトップレベルawaitはサポートされていません。
							//トップレベルawaitを模擬するために、非同期の即時実行関数式内に記述します。
							(async function(){
							
								const image = await je.getImage({
									//利用するデータセットのcollection.jsonのURLを記載します。
									collection: "https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/JAXA.EORC_ALOS.PRISM_AW3D30.v3.2_global/collection.json",
								
									//利用するデータセットのバンドを指定します。
									band: "DSM",
								
									//データを取得する緯度経度範囲を記載します。
									//[最小経度(西), 最小緯度(南), 最大経度(東), 最大緯度(北)]
									bbox: [-180, -90, 180, 90],
								
									//データを取得する画像のサイズをピクセル数で記載します。
									width: 1000,
									height: 500,
								
									//可視化用のカラーマップを指定します。//*****************************************************************
									colorMap: {                 
											//最小値
											min: 0,
											//最大値
											max: 6000,
											//最小値～最大値をjet（青～緑～黄～赤の虹色）で塗りつぶします。
											colors: "jet"
									}   //***************************************************************************************************
								});
								//可視化した結果をHTMLCanvasElementとして取得し、HTML上に追加します。
								document.body.appendChild(image.getCanvas());	
							})();
					 }										
							//動作確認--------------------------------------------------------------------------------------------
					{
								console.log("start");
								console.log("warn");
								console.log(je);
					}
							//---------------------------------------------------------------------------------------------																					
					{
								//function initAnimation(){
								var canvas = document.getElementById('canvas');
								var ctx = canvas.getContext('2d');				
								var imagePath = ('https://www.mhlw.go.jp/content/11600000/001447552.png');
								var image = new Image();
								
								image.src = imagePath;				
								canvas.width = Number(window.innerWidth);
								canvas.height = Number(canvas.width/2);
								image.onload = function(){
									ctx.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);
								}
						}
							//Leaflet_Main-------------------------------------------------------------------------------------------------------			      					             					      					      					    
							//表示するタイルレイヤのURLとAttributionコントロールの記述を設定して、地図に追加する
							//L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
							//attribution: "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>タイルレイヤ：地理院タイル</a>"
							//}).addTo(map); //
									console.log('経度:${latitude}');
									console.log('緯度:${longitude}');
						{														
							//function init() {
							(async function(){
								//地図を表示するdiv要素のidを設定    
								var map = L.map('mapcontainer',{ renderer: L.canvas() });
								//->地図を作成 //->マップ内のすべてのパスにデフォルトでCanvasを使用						  
								//地図の中心とズームレベルを指定                 
								map.setView([37.9473, 139.32825], 15);
								//->「setView」メソッドで経緯度とズームレベルを指定(緯度、経度、ズームレベル)	
								
								var gsi = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', { attribution: gsiattr });
								var gsipale = L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', { attribution: gsiattr });
								var osm = L.tileLayer('http://tile.openstreetmap.jp/{z}/{x}/{y}.png', { attribution: "<a href='http://osm.org/copyright' target='_blank'>OpenStreetMap</a> contributors" });								

								var gsiattr = "<a href='http://portal.cyberjapan.jp/help/termsofuse.html' target='_blank'>地理院タイル</a>"; //引用元表示用
								//オーバーレイ用のタイルレイヤ								
								var gsirelief = L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/relief/{z}/{x}/{y}.png', { opacity: 0.7, maxNativeZoom: 15, attribution: gsiattr });
								var gsirehillshademap = L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/hillshademap/{z}/{x}/{y}.png', { opacity: 0.5, maxNativeZoom: 16, attribution: gsiattr });
								var gsiaa = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { opacity: 1, maxNativeZoom: 15, attribution: gsiattr });
								var gsibb = je.leaflet.createLayer({
															opacity: "0.5", //ダブルクォーテーションで数値を囲むこと。
															L,								
															collection: "https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/JAXA.EORC_ALOS.PRISM_AW3D30.v3.2_global/collection.json",
															band: "DSM",																	
															colorMap: {
																	min: 0,
																	max: 6000,
																	//colors: "ic",
																	colors: "jet",
															      } 												
													});
								var harotirekun = L.tileLayer('https://www.mhlw.go.jp/content/11600000/001447552.png', { opacity: 0.7, maxNativeZoom: 15, attribution: gsiattr });
								
								var nas =  je.leaflet.createLayer({	
															opacity: "0.5", 
															L,								
															collection: "https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/JAXA.EORC_ALOS-2.PALSAR-2_FNF.v2.1.0_global_yearly/collection.json",
															band: "FNF",																	
															colorMap: {														
																	min: 0.3,
																	max: 6000,
																	colors: "gray",														
															}
													});
								var jax = je.leaflet.createLayer({
															opacity: "0.3",
															L,								
															collection: "https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/JAXA.JASMES_GCOM-C.SGLI_standard.L2-NDVI.daytime.v3_japan_8-day/collection.json",
															band: "NDVI_AVE",																	
															colorMap: {														 		
																	min: 0, 
																	max: 6000,
																	colors: "ndvi",																															
															}
													});
									//最小値 //最大値 max: 6000, //最小値～最大値をjet（青～緑～黄～赤の虹色）で塗りつぶします。
								var baseMaps = {
									"地理院地図": gsi,
									"淡色地図": gsipale,
									"オープンストリートマップ": osm,
									"色別標高図": gsirelief,
									"陰影起伏図": gsirehillshademap,
									"openst": gsiaa,
								};
								var overlayMaps  = {
									"色別標高図": gsirelief,
									"陰影起伏図": gsirehillshademap,
									"openst": gsiaa,
								};		
								var earthMaps    = {
									"openst": gsiaa,
									"衛星画像:DSM": gsibb,
									"harotore"   : harotirekun,
									"test2;FNF"   : nas,
									"test3:NDVI"   : jax
								};

								console.log('経度:${latitude}');
								console.log('緯度:${longitude}');
																
								L.marker([37.9473, 139.32825]).addTo(map)
									.bindPopup('新発田市役所[ヨリネスしばた]')
									.openPopup();
								console.log('問題なし1');
						
								{
								// Locate
									        var option = {
										          position: 'topright',
										          strings: {
										              title: "現在地を表示",
										              popup: "いまここ"
										          },
										          locateOptions: {
										            maxZoom: 16
										          }
									           }
											 var lc = L.control.locate(option).addTo(map);
											 // マップ表示時に現在地を取得
									       		lc.start();
								}
															 																		
								L.control.layers(overlayMaps,earthMaps,baseMaps).addTo(map); //2つの引数までしか読み込めない？
								gsi.addTo(map);
							} /*===================================================================================*/
									)();
															
							//ダウンロード時に初期化する
								window.addEventListener('renderer', L.canvas());
						}
			
						
						

	/*
				(async function(){				
					//mport * as je from "jaxa.earth.esm.js";
					const collection ="https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/NASA.EOSDIS_Terra.MODIS_MOD11C1-LST.daytime.v061_global_half-monthly/collection.json";				
					const bbox = [122,20,148,46];        			
					const band = "LST";
					const date = "2023-03-01";
					const colorMap = {
							min: 273.15 - 5,
							max: 273.15 + 35,
							colors: "jet",
						};
				}) */
					
			/*
				{
					const canvas = document.getElementById('canvas');
					const ctx = canvas.getContext('2d');	
					const imagePath = ('https://www.mhlw.go.jp/content/11600000/001447552.png');				
					const image = je.getImage({
						// MODISの地表面温度のデータ
						//collection: collection,
						  collection,
						 colorMap,										
						//bbox: bbox,
						//width: 600,
						//height: 600,
						//onloading: null,
					});				
					
					//image.getCanvas("mapcontainer");
			//可視化した画像をcanvas要素として追加
			//document.main.appendChild(image.getCanvas());
			//カラーマップ凡例をcanvas要素として追加(幅500px、高さ30px、文字サイズ10px)
			//document.main.appendChild(image.getLegend(500, 30, 10));
			 //const div = document.getElementById("map");
							image.src = imagePath;				
					canvas.width = Number(window.innerWidth);
					canvas.height = Number(canvas.width/2);
					image.onload = function(){
							ctx.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);
					}
				document.body.appendChild(image.getCanvas());	
					//データの単位を取得
				console.log(image);
				};
	*/		
					
				//})();
				/*
					// initalize leaflet map
				{
				var map = L.map('map').setView([0, 0], 5);
				var url_to_geotiff_file = "example_4326.tif";					
				fetch(url_to_geotiff_file)
				.then(response => response.arrayBuffer())
				.then(arrayBuffer => {
					parse_georaster(arrayBuffer).then(georaster => {
					console.log("georaster:", georaster);
					var layer = new GeoRasterLayer({
					georaster: georaster,
					opacity: 0.7,
					pixelValuesToColorFn: values => values[0] > 100 ? '#ff0000' : '#0000ff',
					resolution: 64 // optional parameter for adjusting display resolution
					});
					layer.addTo(map);							
					map.fitBounds(layer.getBounds());
					});
				});	
				var canvas = document.getElementById('mapid');
				var c = canvas.getContext("2d"); 
				//const image = document.getElementById("/js/station/om5ru80000003j6y-img/q2k4vk000001680b.png");
				}*/

						//import { coastline } from "/folder/coastline.js";
								/*  動作テスト完了のためコメントアウト	{
										//import * as je from "../jaxa.earth.esm.js";
										
										
										const map = L.map("map", {
												crs: L.CRS.EPSG4326,
												center: [0, 0],
												zoom: 1,
												minZoom: 1,
												maxZoom: 15,
												// maxBounds: [[-90, -360],[90, 360]], //south west north east
											
												// zoomControl: false,
												attributionControl: false,
										});
										
										const geojsonlayer = L.geoJSON('coastline', {
												style:{
														"color": "jet",
														"weight": 1,
														"opacity": 0.5
												}
										}).addTo(map);
										
										je.leaflet.createLayer({									
												L,								
												collection: "https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/JAXA.EORC_ALOS.PRISM_AW3D30.v3.2_global/collection.json",
												band: "DSM",																	
												colorMap: {
														min: 0,
														max: 6000,
														colors: "jet",
												},								
										}).addTo(map);
									}
								*/

				//--------------------------------------------------------------------------------------------------------------------									
			
		</script>
		<!--<body onload="init()">-->
		<div id="mapcontainer" style="position:absolute;top:0;left:0;right:0;bottom:0;"></div>
		<div id="map" style="position:absolute;top:0;left:0;right:0;bottom:0;"></div>
			//Leafletのサンプル（EPSG:4326編）。
			<div id="map"></div>
        <div class="notification" id="notification"></div>
		<div class="buttons">
                <a href="https://shibatazukan.github.io/pages/zukan/list.html" class="button-link"><i class="fa-solid fa-scroll"></i>ずかんを開く </a>
                <a href="https://shibatazukan.github.io/pages/camera/index.html" class="button-link"><i class="fa-solid fa-camera"></i>カメラを開く</a>
                <a href="https://shibatazukan.github.io/pages/camera/index.html" class="button-link"><i class="fa-solid fa-map"></i>マップを開く</a>
                <a href="https://shibatazukan.github.io/pages/MobileNet/index.html" class="button-link"><i class="fa-solid fa-robot"></i>かんたん！AI体験</a>
            </div>
        <script src="https://shibatazukan.github.io/pages/assets/js/home.js"></script>
        <script src="https://shibatazukan.github.io/pages/assets/js/hamburger_menu.js"></script>
	</body>
</html>
